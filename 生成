import cv2
import numpy as np
from sklearn import preprocessing
from sklearn.decomposition import PCA
 # 读取单张人脸图像，并转为灰度图
input_face = cv2.imread('input_face.jpg', cv2.IMREAD_GRAYSCALE)
# 转为 128 x 128 的矩阵
input_face = cv2.resize(input_face, (128, 128))
# 按列展开为一维数组，并进行标准化处理
input_face_vec = np.reshape(input_face, (-1, 1))
input_face_vec = preprocessing.scale(input_face_vec)
 # 加载已有的人脸数据集 X_scaled
X_scaled = np.load('face_data.npy')
 # 将输入的单张人脸图像合并到数据集 X_scaled 中，并进行标准化处理
X_combined = np.hstack((X_scaled, input_face_vec))
X_combined = preprocessing.scale(X_combined)
 # 使用 PCA 算法提取主成分
pca = PCA(n_components=10)
pca.fit(X_combined)
components = pca.components_
 # 将主成分恢复为图像矩阵，并显示出来
components = np.reshape(components, (10, 128, 128))
for i in range(10):
    cv2.imshow('component {}'.format(i+1), components[i])
cv2.waitKey(0)

